function smoothZoom(){var t=$(".map-box"),e=t.width(),a=t.height();$("#image").width("6480").height("3443"),$("#image").smoothZoom({width:e,height:a,initial_ZOOM:30,zoom_MIN:e/"6480"*50,zoom_MAX:500,zoom_BUTTONS_SHOW:!1,pan_BUTTONS_SHOW:!1,reset_ALIGN_TO:"center center",pan_LIMIT_BOUNDARY:!1,mouse_DOUBLE_CLICK:!1,background_COLOR:"transparent",container:"mapwrap",button_ALIGN:"center right",button_MARGIN:30,initial_POSITION:"3240 2000",on_ZOOM_PAN_COMPLETE:function(t){ratio=t.ratio}})}function drawTrack(t){$.each(t,function(t,e){$("<div>",{class:"stock-market-item","data-obj":JSON.stringify(e),style:"top:"+e.y+"px;left:"+e.x+"px;width:"+e.width+"px;"}).appendTo($(".stock-market"))})}function showSpecialTrains(t){$.each(t,function(t,e){showTrain(e)})}function showTrain(t){var e="";$.each(trackData,function(a,o){t.track==o.id&&(e=o)});var a=$("<div>",{id:"train_"+t.id,style:"top:"+e.y+"px; left:"+e.center+"px;",class:"stock-train-item ","data-train-id":t.id,"data-train-thing":t.thing,"data-stock-id":t.track,"data-step-length":t.step?t.step.length:0}).appendTo($(".stock-train"));"n"==t.state&&$(a).addClass("stock-train-item-warning");var o=$("<div>",{class:"train-info"}).appendTo(a);$("<span>",{text:t.numberWest||"",class:"train-info-item"}).appendTo(o),$("<span>",{text:t.number||"",class:"train-info-item train-info-number"}).appendTo(o),$("<span>",{text:t.numberEast||"",class:"train-info-item"}).appendTo(o);var n=$("<div>",{class:"stock-train-step-box stock-train-left"}).appendTo(a),i=$("<div>",{class:"stock-train-step-box stock-train-left-top"}).appendTo(a),c=$("<div>",{class:"stock-train-step-box stock-train-right"}).appendTo(a),r=$("<div>",{class:"stock-train-step-box stock-train-right-top"}).appendTo(a);t.step&&$.each(t.step,function(t,e){if("shoes"===e.type)if("l"===e.direction)a=$("<div>",{class:"stock-train-step stock-train-shoes"}).prependTo(n);else a=$("<div>",{class:"stock-train-step stock-train-shoes"}).appendTo(c);if("fastener"===e.type)if("l"===e.direction)a=$("<div>",{class:"stock-train-step stock-train-fastener"}).prependTo(i);else a=$("<div>",{class:"stock-train-step stock-train-fastener"}).appendTo(r);if("brake"===e.type)if("l"===e.direction)a=$("<div>",{class:"stock-train-step stock-train-brake"}).appendTo(i);else var a=$("<div>",{class:"stock-train-step stock-train-brake"}).prependTo(r);e.name&&$("<span>",{class:"top-name",text:e.name}).appendTo(a),e.text&&$("<span>",{class:"top-text",text:e.text}).appendTo(a),a.attr("data-step-id",e.id),"n"==e.state&&a&&a.addClass("questions")})}function clearValue(t){t.find("select").select2("val",""),t.find("input.text").val(""),t.find(".self-is-clone").remove()}function dragStart(t){dragStartX=t.pageX-$(t.target).offset().left,dragStartY=t.pageY-$(t.target).offset().top}function dragEnd(t){t.preventDefault();var e=(t.pageX-dragStartX-$("#stockToolBox").offset().left)/ratio,a=(t.pageY-dragStartY-$("#stockToolBox").offset().top)/ratio,o=guid(),n=$(t.target).text(),i=$(t.target).data("type"),c=$(t.target).data("system");appData.stockToolList.push({id:o,x:e,y:a,type:i,text:n,system:c}),drawTool(appData.stockToolList)}function drawTool(t){$("#stockToolBox").empty(),$.each(t,function(t,e){$("<a>",{text:e.text,"data-type":e.type,"data-system":e.system,style:"top:"+e.y+"px; left:"+e.x+"px;",id:e.id,class:"tool-item"}).appendTo($("#stockToolBox"))})}function startCurrentTime(t){var e=t||moment().format("YYYY-MM-DD HH:mm:ss");setCurrentTime(e),setInterval(function(){setCurrentTime(e=moment(e).add(1,"seconds"))},1e3)}function setCurrentTime(t){var e=moment(t).format("YYYY年MM月DD日"),a=getWeek(t),o=moment(t).hour()>9?moment(t).hour():"0"+moment(t).hour(),n=moment(t).minute()>9?moment(t).minute():"0"+moment(t).minute(),i=moment(t).second()>9?moment(t).second():"0"+moment(t).second();$("#currentDay").text(e),$("#currentWeek").text(a),$("#currentHour").text(o),$("#currentMinute").text(n),$("#currentSecond").text(i)}function getWeek(t){switch(moment(t).day()){case 1:return"星期一";case 2:return"星期二";case 3:return"星期三";case 4:return"星期四";case 5:return"星期五";case 6:return"星期六";case 0:return"星期日"}}function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}$(function(){$(document).on("click",".page-sidebar-toggle",function(t){$("#page-container").hasClass("page-sidebar-hide")?$("#page-container").removeClass("page-sidebar-hide"):$("#page-container").addClass("page-sidebar-hide")}),$(".moc-tabs").mocTabs({startBack:function(){$(".moc-tabs-body").animate({scrollTop:0},0)}}),smoothZoom(),$(document).on("click",".toggle-btn",function(t){$(this).closest(".boxs").toggleClass("close")})});var ratio=1,dragStartX=0,dragStartY=0;$(function(){var t=$("#image");$("#stockToolBox").livequery(".tool-item",function(){$(this).draggable({appendTo:"#stockToolBox",start:function(e,a){t.smoothZoom("pause")},drag:function(t,e){var a={x:e.position.left/ratio,y:e.position.top/ratio};e.position.left=a.x,e.position.top=a.y},stop:function(e,a){t.smoothZoom("resume");var o=appData.stockToolList.find(function(t){return t.id==a.helper.attr("id")});o.x=a.position.left,o.y=a.position.top}})}),$(document).on("click",".tool-item-reset",function(t){appData.stockToolList=[],$("#stockToolBox").empty()}),$(document).on("dblclick","#stockToolBox .tool-item",function(t){var e=$(this).attr("id"),a=appData.stockToolList.findIndex(function(t){return t.id==e});appData.stockToolList.splice(a,1),drawTool(appData.stockToolList)})}),$(function(){if($(".select-2").select2&&($(".select-2").select2({placeholder:"请选择"}),$(".select-2ns").select2({minimumResultsForSearch:1/0,placeholder:"请选择"}),$(".select-2nc").select2({closeOnSelect:!1,placeholder:"请选择"}),$(".select-2nc-tag").select2({tags:!0,closeOnSelect:!1,placeholder:"请选择"}),$(".select-2tag").select2({tags:!0,placeholder:"请选择"})),$(".icheck-primary").iCheck){$(".icheck-primary").iCheck({checkboxClass:"checkbox-primary",radioClass:"radio-primary"}),$(".icheck-success").iCheck({checkboxClass:"checkbox-success",radioClass:"radio-success"});var checkAll=$('[ichecked-for][type="checkbox"]');$(document).on("ifChecked ifUnchecked",'[ichecked-for][type="checkbox"]',function(t){var e=$(this).attr("ichecked-for"),a=$('[ichecked-val="'+e+'"]');"ifChecked"===t.type?a.not("[disabled]").iCheck("check"):a.not("[disabled]").iCheck("uncheck")}),$(document).on("ifChecked ifUnchecked",'[ichecked-val][type="checkbox"]',function(t){if($(this).attr("old-name")&&" "!=$(this).attr("old-name")){var e=$(this).attr("old-name"),a=$(this).closest("td,th").attr("fixedtable-clone-id"),o=$('[fixedtable-id="'+a+'"]');"ifChecked"==t.type?o.find('[name="'+e+'"]').iCheck("check"):o.find('[name="'+e+'"]').iCheck("uncheck")}if(checkAll.length>0){var n=$(this).attr("ichecked-val"),i=$('[ichecked-for="'+n+'"]');if(1==i.length&&void 0!=i.attr("ichecked-for")){var c=$('[ichecked-val="'+n+'"]');c.not("[disabled]").filter(":checked").length==c.not("[disabled]").length?i.iCheck("check"):(i.prop("checked",!1),i.parent().removeClass("checked").attr("aria-checked","false")),i.iCheck("update")}}})}if($("form").Validform){var ValidformDom=$('[data-Validform="Validform"]'),ignoreHidden="false"!==ValidformDom.attr("ignoreHidden");ValidformDom.Validform({btnSubmit:"#validFormSubmit",btnReset:"#validFormReset",ignoreHidden:ignoreHidden,dragonfly:!1,tipSweep:!1,showAllError:!0,label:".Validform_label",postonce:!1,ajaxPost:!1,tiptype:function(t,e,a){var o=e.obj.closest(".form-content");if(o.find(".form-checktip").length<=0)n=$("<p>",{class:"form-checktip"}).appendTo(o);else var n=o.find(".form-checktip");a(n,e.type),n.text(t),2!=e.type?n.text(t):(n.text(""),n.removeClass("Validform_right"))},beforeCheck:function(curform){var beforeCheckFn=eval(ValidformDom.attr("data-beforeCheck"));if("function"==typeof beforeCheckFn){var flag=beforeCheckFn(curform);if(!1===flag)return!1}},beforeSubmit:function(curform){var beforeSubmitFn=eval(ValidformDom.attr("data-beforeSubmit"));if("function"==typeof beforeSubmitFn){var flag=beforeSubmitFn(curform);if(!1===flag)return!1}},callback:function(data){var callbackFn=eval(ValidformDom.attr("data-callback"));if("function"==typeof callbackFn){var flag=callbackFn(data);if(!1===flag)return!1}}}).ignore('[disabled="true"],[ignore="yes"]'),$(".select-2, .select-2ns, .select-2nc, .select-2-template, .select-2ns-template, .select-2nc-template, .select-2-call, .select-2ns-call, .select-2nc-call").on("change",function(t){$(this).blur()}),$(".icheck-primary, .icheck-primary-template, .icheck-primary-call").on("ifChanged",function(t){$(this).blur()})}$('[data-toggle="left-nav"]').mocLeftNav({activeCls:"active"}),$('[data-toggle="dropdown"]').dropdown(),$(document).draggable&&($(".modal-draggable").draggable({handle:".modal-header"}),$(".mocAlert").draggable({handle:".mocAlert_head"}))});